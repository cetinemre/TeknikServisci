@using TeknikServisci.Models.Enums
@using TeknikServisci.Models.ViewModels
@model TeknikServisci.Models.ViewModels.FailureViewModel
@{
	ViewBag.Title = $"{Model.FailureName} arızasının ayrıntıları";
	Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<div class="pageheader hidden-xs">
	<h3><i class="fa fa-search-plus"></i>Arıza Ayrıntısı</h3>
</div>
<!--CONTENT CONTAINER-->
<!--===================================================-->
<div id="content-container">
	<!--Page content-->
	<!--===================================================-->
	<div id="page-content">
        <div class="row">
            <div class="col-md-6">
                <div class="panel">
                    <div class="panel-heading">
                        <h3 class="panel-title">@Model.FailureName adlı arızanın ayrıntıları</h3>
                        <h3>@TempData["Message"]</h3>
                        @Html.ValidationSummary()
                    </div><br /><br /><br /><br />
                    <!-- Striped Table -->
                    <!--===================================================-->
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <tbody>
                                    <tr>
                                        <th>Arızanın:</th>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th>Kodu</th>
                                        <td>@Model.FailureId</td>
                                    </tr>
                                    <tr>
                                        <th>Adı</th>
                                        <td>@Model.FailureName</td>
                                    </tr>
                                    <tr>
                                        <th>Parçanın Modeli</th>
                                        <td>@Model.ProductModel</td>
                                    </tr>
                                    <tr>
                                        <th>Açıklama</th>
                                        <td>@Model.Description</td>
                                    </tr>
                                    <tr>
                                        <th>Fotoğrafı</th>
                                        <td><img src="@(string.IsNullOrEmpty(Model.PhotoPath) ? "/assets/img/nofailurephoto.png" : Model.PhotoPath)" width="400" height="300" /></td>
                                    </tr>
                                    <tr>
                                        <th>Arızayı Bildirenin:</th>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th>Kullanıcı ID</th>
                                        <td>@Model.ClientId</td>
                                    </tr>
                                    <tr>
                                        <th>Adı</th>
                                        <td>@Model.ClientName</td>
                                    </tr>
                                    <tr>
                                        <th>Soyadı</th>
                                        <td>@Model.ClientSurname</td>
                                    </tr>
                                    <tr>
                                        <th>Adresi</th>
                                        <td>@Model.Address</td>
                                    </tr>
                                    <tr>
                                        <th>Teknisyen</th>
                                        <td>@Model.Technician</td>
                                    </tr>
                                    <tr>
                                        <th>Teknisyenin durumu</th>
                                        <td>
                                            @using (Html.BeginForm("TechnicianStartWork", "Technician", FormMethod.Post, new { @class = "form-horizontal" }))
                                            {
                                                @Html.AntiForgeryToken()
                                                @Html.HiddenFor(x => x.FailureId)
                                                switch (Model.TechnicianStatus)
                                                {
                                                    case TeknikServisci.Models.Enums.TechnicianStatuses.Available:
                                                        <button class="btn btn-warning" type="submit">Yola Çıktım</button>
                                                        break;
                                                    case TeknikServisci.Models.Enums.TechnicianStatuses.OnWay:
                                                        <button class="btn btn-success" type="submit">Hedefe Ulaştım</button>
                                                        break;
                                                    case TeknikServisci.Models.Enums.TechnicianStatuses.OnWork:
                                                        <button class="btn btn-success" type="submit">İşlem Tamamlandı</button>
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Reddet</th>
                                        <td>
                                            @using (Html.BeginForm("Decline", "Operator", FormMethod.Post, new { @class = "form-horizontal" }))
                                            {
                                                @Html.AntiForgeryToken()
                                                @Html.HiddenFor(x => x.FailureId)
                                                @Html.TextBoxFor(x => x.Report, new { @class = "form-control" })
                                                @Html.ValidationMessageFor(x => x.Description, "", new { @class = "text-danger" })
                                                <button class="btn btn-danger" type="submit">Reddet</button>
                                            }
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!--===================================================-->
                    <!-- End Striped Table -->
                </div>
            </div>
            <div class="col-md-4">
                <div class="panel">
                    <div class="panel-heading">
                        <h3 class="panel-title">Olaylar</h3><h3></h3>
                    </div><br />
                    <div class="panel-body">
                        <div class="timeline">
                            <!-- Timeline header -->
                            <div class="timeline-header">
                                <div class="timeline-header-title bg-info">Şimdi</div>
                            </div>

                            @foreach (OperationViewModel operation in Model.Operations)
                            {
                                <div class="timeline-entry">
                                    <div class="timeline-stat">
                                        @switch (operation.FromWhom)
                                        {
                                            case IdentityRoles.Operator:
                                                <div class="timeline-icon bg-success"><i class="fa fa-clipboard fa-lg"></i> </div>
                                                break;
                                            case IdentityRoles.User:
                                                <div class="timeline-icon bg-info"><i class="fa fa-check fa-lg"></i> </div>
                                                break;
                                            case IdentityRoles.Technician:
                                                <div class="timeline-icon bg-warning"><i class="fa fa-briefcase fa-lg"></i> </div>
                                                break;
                                            default:
                                                <div class="timeline-icon bg-purple"><i class="fa fa-check fa-lg"></i> </div>
                                                break;
                                        }
                                    </div>
                                    <div class="timeline-label">
                                        @operation.CreatedDate
                                        <h3>@operation.Message</h3>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <!--===================================================-->
                    <!-- End Striped Table -->
                </div>
            </div>

        </div>
		<!--===================================================-->
		<!--END CONTENT CONTAINER-->
	</div>
</div>
<!--===================================================-->
<!-- END OF CONTAINER -->